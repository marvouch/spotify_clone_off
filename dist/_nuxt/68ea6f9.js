(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{324:function(e,t,r){"use strict";var n=r(2),o=r(72).find,c=r(152),l="find",d=!0;l in[]&&Array(1)[l]((function(){d=!1})),n({target:"Array",proto:!0,forced:d},{find:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),c(l)},326:function(e,t,r){"use strict";var n=r(2),o=r(219).trim;n({target:"String",proto:!0,forced:r(327)("trim")},{trim:function(){return o(this)}})},327:function(e,t,r){"use strict";var n=r(93).PROPER,o=r(4),c=r(220);e.exports=function(e){return o((function(){return!!c[e]()||"​᠎"!=="​᠎"[e]()||n&&c[e].name!==e}))}},355:function(e,t,r){var content=r(385);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(92).default)("04a3144b",content,!0,{sourceMap:!1})},364:function(e,t,r){"use strict";var n=r(2),o=r(72).findIndex,c=r(152),l="findIndex",d=!0;l in[]&&Array(1)[l]((function(){d=!1})),n({target:"Array",proto:!0,forced:d},{findIndex:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),c(l)},365:function(e,t,r){"use strict";var n=r(2),o=r(3),c=r(37),l=r(28),d=r(45),v=r(225),f=r(13),h=r(4),y=r(226),k=r(158),m=r(366),x=r(367),w=r(95),_=r(368),P=[],T=o(P.sort),$=o(P.push),C=h((function(){P.sort(void 0)})),j=h((function(){P.sort(null)})),R=k("sort"),I=!h((function(){if(w)return w<70;if(!(m&&m>3)){if(x)return!0;if(_)return _<603;var code,e,t,r,n="";for(code=65;code<76;code++){switch(e=String.fromCharCode(code),code){case 66:case 69:case 70:case 72:t=3;break;case 68:case 71:t=4;break;default:t=2}for(r=0;r<47;r++)P.push({k:e+r,v:t})}for(P.sort((function(a,b){return b.v-a.v})),r=0;r<P.length;r++)e=P[r].k.charAt(0),n.charAt(n.length-1)!==e&&(n+=e);return"DGBEFHACIJK"!==n}}));n({target:"Array",proto:!0,forced:C||!j||!R||!I},{sort:function(e){void 0!==e&&c(e);var t=l(this);if(I)return void 0===e?T(t):T(t,e);var r,n,o=[],h=d(t);for(n=0;n<h;n++)n in t&&$(o,t[n]);for(y(o,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:f(t)>f(r)?1:-1}}(e)),r=d(o),n=0;n<r;)t[n]=o[n++];for(;n<h;)v(t,n++);return t}})},366:function(e,t,r){"use strict";var n=r(52).match(/firefox\/(\d+)/i);e.exports=!!n&&+n[1]},367:function(e,t,r){"use strict";var n=r(52);e.exports=/MSIE|Trident/.test(n)},368:function(e,t,r){"use strict";var n=r(52).match(/AppleWebKit\/(\d+)\./);e.exports=!!n&&+n[1]},384:function(e,t,r){"use strict";r(355)},385:function(e,t,r){var n=r(91)((function(i){return i[1]}));n.push([e.i,'.material-icons[data-v-29dfe8e3]{display:inline-block;font-family:"Material Icons";font-size:24px;font-style:normal;font-weight:400;letter-spacing:normal;line-height:1;text-transform:none;white-space:nowrap;word-wrap:normal;direction:ltr;-webkit-font-feature-settings:"liga";-webkit-font-smoothing:antialiased;transition:transform .2s ease-in-out}button:hover .material-icons[data-v-29dfe8e3]{transform:scale(1.1)}input[type=range][data-v-29dfe8e3]{-webkit-appearance:none;-moz-appearance:none;appearance:none;background:transparent}input[type=range][data-v-29dfe8e3]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;background:#fff;border-radius:50%;cursor:pointer;height:12px;margin-top:-5px;width:12px}input[type=range][data-v-29dfe8e3]::-moz-range-thumb{background:#fff;border:none;border-radius:50%;cursor:pointer;height:12px;width:12px}input[type=range][data-v-29dfe8e3]:focus{outline:none}input[type=range][data-v-29dfe8e3]::-webkit-slider-runnable-track{background:#4a4a4a;border-radius:1px;height:2px;width:100%}input[type=range][data-v-29dfe8e3]::-moz-range-track{background:#4a4a4a;border-radius:1px;height:2px;width:100%}',""]),n.locals={},e.exports=n},398:function(e,t,r){"use strict";r.r(t);r(35);var n=r(147);var o=r(201),c=r(111);function l(e){return function(e){if(Array.isArray(e))return Object(n.a)(e)}(e)||Object(o.a)(e)||Object(c.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var d=r(14),v=r(25),f=(r(69),r(73),r(41),r(324),r(364),r(53),r(365),r(16),r(32),r(36),r(70),r(71),r(51),r(336),r(42),r(337),r(326),r(338),r(339),r(340),r(341),r(342),r(343),r(344),r(345),r(346),r(347),r(348),r(349),r(350),r(351),r(352),r(353),r(31),r(43),r(94),r(74)),h=r(323),y=r(330),k=r(329);function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){Object(v.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var w={components:{Sidebar:h.a,PlayerBar:y.a},data:function(){return{userPlaylists:[],likedTracks:[],likedTracksIds:new Set,showCreatePlaylistModal:!1,newPlaylistName:"",newPlaylistDescription:"",activeTab:"playlists",currentTrack:null,isPlaying:!1,player:null,deviceId:null,searchQuery:"",searchResults:null,searchTimeout:null,currentTime:0,duration:0,volume:50,isMuted:!1,previousVolume:50,isPlayerReady:!1,pendingTrack:null,pendingPlaylist:null,showAddToPlaylistModal:!1,selectedTrack:null}},computed:{volumeIcon:function(){return this.isMuted||0===this.volume?"volume_off":this.volume<30?"volume_down":(this.volume,"volume_up")}},mounted:function(){this.loadLibrary(),this.loadLikedTracks(),this.initializePlayer()},beforeDestroy:function(){this.$root.$off("player-ready",this.handlePlayerReady),this.$root.$off("player-not-ready",this.handlePlayerNotReady),this.$root.$off("player-state-changed",this.handlePlayerStateChanged)},methods:x(x({},Object(f.c)(["setDeviceId"])),{},{initializePlayer:function(){var e=this;return Object(d.a)(regeneratorRuntime.mark((function t(){var r,script;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=localStorage.getItem("spotify_access_token")){t.next=4;break}return console.error("No access token available"),t.abrupt("return");case 4:window.Spotify||((script=document.createElement("script")).src="https://sdk.scdn.co/spotify-player.js",script.async=!0,document.body.appendChild(script)),window.Spotify?e.setupPlayer(r):window.onSpotifyWebPlaybackSDKReady=function(){e.setupPlayer(r)};case 6:case"end":return t.stop()}}),t)})))()},setupPlayer:function(e){var t=this;this.player=new Spotify.Player({name:"Spotify Clone Player",getOAuthToken:function(t){t(e)},volume:.5}),this.player.addListener("initialization_error",(function(e){var r=e.message;console.error("Failed to initialize:",r),t.$toast.error("Erreur d'initialisation du lecteur")})),this.player.addListener("authentication_error",(function(e){var r=e.message;console.error("Failed to authenticate:",r),t.$toast.error("Erreur d'authentification"),t.$router.push("/login")})),this.player.addListener("account_error",(function(e){var r=e.message;console.error("Failed to validate Spotify account:",r),t.$toast.error("Erreur de compte Spotify")})),this.player.addListener("playback_error",(function(e){var r=e.message;console.error("Failed to perform playback:",r),t.$toast.error("Erreur de lecture")})),this.player.addListener("player_state_changed",(function(e){if(e){var r,n,track=e.track_window.current_track;t.currentTrack={id:track.id,name:track.name,artist:null===(r=track.artists[0])||void 0===r?void 0:r.name,albumCover:null===(n=track.album.images[0])||void 0===n?void 0:n.url},t.isPlaying=!e.paused,t.duration=e.duration/1e3,t.currentTime=e.position/1e3}})),this.player.addListener("ready",(function(e){var r=e.device_id;console.log("Player is ready with device ID:",r),t.deviceId=r,t.setDeviceId(r),localStorage.setItem("spotify_device_id",r),t.isPlayerReady=!0,t.$toast.success("Lecteur prêt"),t.pendingTrack&&(t.playTrack(t.pendingTrack),t.pendingTrack=null)})),this.player.addListener("not_ready",(function(e){var r=e.device_id;console.log("Player is not ready:",r),t.isPlayerReady=!1,t.$toast.error("Lecteur non prêt")})),this.player.connect().then((function(e){e?console.log("Successfully connected to Spotify!"):(console.error("Failed to connect to Spotify"),t.$toast.error("Échec de la connexion à Spotify"))}))},playTrack:function(e){var t=this;return Object(d.a)(regeneratorRuntime.mark((function r(){var n,o,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,Object(k.a)();case 3:if(n=r.sent,o=localStorage.getItem("spotify_device_id"),n&&o){r.next=9;break}return console.error("No token or device ID available"),t.$toast.error("Le lecteur n'est pas prêt. Veuillez réessayer."),r.abrupt("return");case 9:return r.next=11,t.$axios.$put("https://api.spotify.com/v1/me/player",{device_ids:[o],play:!1},{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 11:return console.log("Playing track:",e),r.next=14,t.$axios.$put("https://api.spotify.com/v1/me/player/play?device_id=".concat(o),{uris:[e]},{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 14:t.$toast.success("Lecture démarrée"),r.next=34;break;case 17:if(r.prev=17,r.t0=r.catch(0),console.error("Error playing track:",r.t0),t.$toast.error("Erreur lors de la lecture du morceau"),401!==(null===(c=r.t0.response)||void 0===c?void 0:c.status)){r.next=34;break}return r.prev=22,r.next=25,Object(k.a)();case 25:return r.next=27,t.playTrack(e);case 27:r.next=34;break;case 29:r.prev=29,r.t1=r.catch(22),console.error("Error refreshing token:",r.t1),t.$toast.error("Session expirée. Veuillez vous reconnecter."),t.$router.push("/login");case 34:case"end":return r.stop()}}),r,null,[[0,17],[22,29]])})))()},transferPlayback:function(){var e=this;return Object(d.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,(r=localStorage.getItem("spotify_access_token"))&&e.deviceId){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.$axios.$put("https://api.spotify.com/v1/me/player",{device_ids:[e.deviceId],play:!1},{headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});case 6:console.log("Playback transferred to device:",e.deviceId),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.error("Error transferring playback:",(null===(n=t.t0.response)||void 0===n?void 0:n.data)||t.t0.message);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},togglePlayback:function(){var e=this;return Object(d.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=localStorage.getItem("spotify_access_token")){t.next=5;break}return console.error("No access token available"),t.abrupt("return");case 5:if(!e.isPlaying){t.next=10;break}return t.next=8,e.$axios.$put("https://api.spotify.com/v1/me/player/pause?device_id=".concat(e.deviceId),{},{headers:{Authorization:"Bearer ".concat(r)}});case 8:t.next=12;break;case 10:return t.next=12,e.$axios.$put("https://api.spotify.com/v1/me/player/play?device_id=".concat(e.deviceId),{},{headers:{Authorization:"Bearer ".concat(r)}});case 12:e.isPlaying=!e.isPlaying,t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),console.error("Error toggling playback:",(null===(n=t.t0.response)||void 0===n?void 0:n.data)||t.t0.message);case 18:case"end":return t.stop()}}),t,null,[[0,15]])})))()},previousTrack:function(){var e=this;return Object(d.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,(r=localStorage.getItem("spotify_access_token"))&&e.deviceId){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.$axios.$post("https://api.spotify.com/v1/me/player/previous?device_id=".concat(e.deviceId),{},{headers:{Authorization:"Bearer ".concat(r)}});case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("Error playing previous track:",(null===(n=t.t0.response)||void 0===n?void 0:n.data)||t.t0.message);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},nextTrack:function(){var e=this;return Object(d.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,(r=localStorage.getItem("spotify_access_token"))&&e.deviceId){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.$axios.$post("https://api.spotify.com/v1/me/player/next?device_id=".concat(e.deviceId),{},{headers:{Authorization:"Bearer ".concat(r)}});case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("Error playing next track:",(null===(n=t.t0.response)||void 0===n?void 0:n.data)||t.t0.message);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},toggleLike:function(e){var t=this;return Object(d.a)(regeneratorRuntime.mark((function r(){var n,o,c,l,d,track,v,f;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,o=localStorage.getItem("spotify_access_token")){r.next=7;break}return console.error("No access token available"),t.$toast.error("Erreur d'authentification. Veuillez vous reconnecter."),t.$router.push("/login"),r.abrupt("return");case 7:return c=t.isTrackLiked(e),l=c?"delete":"put",console.log("".concat(c?"Unliking":"Liking"," track:"),e),r.next=12,t.$axios[l]("https://api.spotify.com/v1/me/tracks",{ids:[e]},{headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"}});case 12:return c?(t.likedTracksIds.delete(e),t.likedTracks=t.likedTracks.filter((function(track){return track.id!==e}))):(t.likedTracksIds.add(e),(track=null===(d=t.searchResults)||void 0===d||null===(d=d.tracks)||void 0===d||null===(d=d.items)||void 0===d?void 0:d.find((function(t){return t.id===e})))&&t.likedTracks.push(track)),null!==(n=t.searchResults)&&void 0!==n&&null!==(n=n.tracks)&&void 0!==n&&n.items&&-1!==(v=t.searchResults.tracks.items.findIndex((function(t){return t.id===e})))&&(t.searchResults.tracks.items[v].isLiked=!c),t.$toast.success(c?"Titre retiré des favoris":"Titre ajouté aux favoris"),r.next=17,t.loadLikedTracks();case 17:r.next=41;break;case 19:if(r.prev=19,r.t0=r.catch(0),console.error("Error toggling like:",r.t0),t.$toast.error("Erreur lors de la modification des favoris"),401!==(null===(f=r.t0.response)||void 0===f?void 0:f.status)){r.next=41;break}return r.prev=24,r.next=27,t.$auth.refreshToken();case 27:if(!r.sent){r.next=33;break}return r.next=31,t.toggleLike(e);case 31:r.next=34;break;case 33:t.$router.push("/login");case 34:r.next=41;break;case 36:r.prev=36,r.t1=r.catch(24),console.error("Error refreshing token:",r.t1),t.$toast.error("Session expirée. Veuillez vous reconnecter."),t.$router.push("/login");case 41:case"end":return r.stop()}}),r,null,[[0,19],[24,36]])})))()},isTrackLiked:function(e){return this.likedTracksIds.has(e)},loadLibrary:function(){var e=this;return Object(d.a)(regeneratorRuntime.mark((function t(){var r,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=localStorage.getItem("spotify_access_token")){t.next=5;break}return console.error("No access token available"),t.abrupt("return");case 5:return t.next=7,e.$axios.$get("https://api.spotify.com/v1/me/playlists",{headers:{Authorization:"Bearer ".concat(r)},params:{limit:50,offset:0}});case 7:(n=t.sent)&&n.items&&(e.userPlaylists=n.items.filter((function(e){return null!==e})).sort((function(a,b){return a.name.localeCompare(b.name)}))),t.next=32;break;case 11:if(t.prev=11,t.t0=t.catch(0),console.error("Error loading library:",t.t0),401!==(null===(o=t.t0.response)||void 0===o?void 0:o.status)){t.next=32;break}return t.prev=15,t.next=18,e.$auth.refreshToken();case 18:if(!t.sent){t.next=24;break}return t.next=22,e.loadLibrary();case 22:t.next=25;break;case 24:e.$router.push("/login");case 25:t.next=32;break;case 27:t.prev=27,t.t1=t.catch(15),console.error("Error refreshing token:",t.t1),e.$toast.error("Session expirée. Veuillez vous reconnecter."),e.$router.push("/login");case 32:case"end":return t.stop()}}),t,null,[[0,11],[15,27]])})))()},loadLikedTracks:function(){var e=this;return Object(d.a)(regeneratorRuntime.mark((function t(){var r,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=localStorage.getItem("spotify_access_token")){t.next=7;break}return console.error("No access token available"),e.$toast.error("Erreur d'authentification. Veuillez vous reconnecter."),e.$router.push("/login"),t.abrupt("return");case 7:return console.log("Loading liked tracks..."),t.next=10,e.$axios.$get("https://api.spotify.com/v1/me/tracks",{headers:{Authorization:"Bearer ".concat(r)},params:{limit:50,market:"FR"}});case 10:(n=t.sent)&&n.items&&(e.likedTracks=n.items.map((function(e){return e.track})).filter((function(track){return null!==track})),e.likedTracksIds=new Set(e.likedTracks.map((function(track){return track.id}))),console.log("Liked tracks loaded:",e.likedTracks.length)),t.next=36;break;case 14:if(t.prev=14,t.t0=t.catch(0),console.error("Error loading liked tracks:",t.t0),401!==(null===(o=t.t0.response)||void 0===o?void 0:o.status)){t.next=36;break}return t.prev=18,t.next=21,e.$auth.refreshToken();case 21:if(!t.sent){t.next=27;break}return t.next=25,e.loadLikedTracks();case 25:t.next=29;break;case 27:e.$toast.error("Session expirée. Veuillez vous reconnecter."),e.$router.push("/login");case 29:t.next=36;break;case 31:t.prev=31,t.t1=t.catch(18),console.error("Error refreshing token:",t.t1),e.$toast.error("Session expirée. Veuillez vous reconnecter."),e.$router.push("/login");case 36:case"end":return t.stop()}}),t,null,[[0,14],[18,31]])})))()},createPlaylist:function(){var e=this;return Object(d.a)(regeneratorRuntime.mark((function t(){var r,n,o,c,d,v,f,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=localStorage.getItem("spotify_access_token")){t.next=7;break}return console.error("No access token available"),e.$toast.error("Erreur d'authentification. Veuillez vous reconnecter."),e.$router.push("/login"),t.abrupt("return");case 7:if(e.newPlaylistName.trim()){t.next=10;break}return e.$toast.error("Le nom de la playlist est requis"),t.abrupt("return");case 10:return t.next=12,e.$axios.$get("https://api.spotify.com/v1/me",{headers:{Authorization:"Bearer ".concat(n)}});case 12:if((o=t.sent)&&o.id){t.next=15;break}throw new Error("Could not get user profile");case 15:return c={name:e.newPlaylistName.trim(),description:(null===(r=e.newPlaylistDescription)||void 0===r?void 0:r.trim())||"",public:!1},t.next=18,e.$axios.$post("https://api.spotify.com/v1/users/".concat(o.id,"/playlists"),c,{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 18:if((d=t.sent)&&d.id){t.next=21;break}throw new Error("Failed to create playlist");case 21:return e.userPlaylists=[d].concat(l(e.userPlaylists)),e.newPlaylistName="",e.newPlaylistDescription="",e.showCreatePlaylistModal=!1,e.$toast.success("Playlist créée avec succès!"),t.next=28,e.loadLibrary();case 28:t.next=54;break;case 30:if(t.prev=30,t.t0=t.catch(0),console.error("Error creating playlist:",t.t0),h="Erreur lors de la création de la playlist",null!==(v=t.t0.response)&&void 0!==v&&null!==(v=v.data)&&void 0!==v&&null!==(v=v.error)&&void 0!==v&&v.message&&(h=t.t0.response.data.error.message),e.$toast.error(h),401!==(null===(f=t.t0.response)||void 0===f?void 0:f.status)){t.next=54;break}return t.prev=37,t.next=40,e.$auth.refreshToken();case 40:if(!t.sent){t.next=46;break}return t.next=44,e.createPlaylist();case 44:t.next=47;break;case 46:e.$router.push("/login");case 47:t.next=54;break;case 49:t.prev=49,t.t1=t.catch(37),console.error("Error refreshing token:",t.t1),e.$toast.error("Session expirée. Veuillez vous reconnecter."),e.$router.push("/login");case 54:case"end":return t.stop()}}),t,null,[[0,30],[37,49]])})))()},playPlaylist:function(e){var t=this;return Object(d.a)(regeneratorRuntime.mark((function r(){var n,o,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.isPlayerReady){r.next=4;break}return console.log("Player not ready, storing playlist for later:",e),t.pendingPlaylist=e,r.abrupt("return");case 4:return r.prev=4,r.next=7,Object(k.a)();case 7:if(n=r.sent,o=localStorage.getItem("spotify_device_id"),n&&o){r.next=12;break}return console.error("No token or device ID available"),r.abrupt("return");case 12:return console.log("Playing playlist:",e),r.next=15,t.$axios.$put("https://api.spotify.com/v1/me/player/play?device_id=".concat(o),{context_uri:e},{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 15:r.next=32;break;case 17:if(r.prev=17,r.t0=r.catch(4),console.error("Error playing playlist:",r.t0),401!==(null===(c=r.t0.response)||void 0===c?void 0:c.status)){r.next=32;break}return r.prev=21,r.next=24,Object(k.a)();case 24:return r.next=26,t.playPlaylist(e);case 26:r.next=32;break;case 28:r.prev=28,r.t1=r.catch(21),console.error("Error refreshing token:",r.t1),t.$router.push("/login");case 32:case"end":return r.stop()}}),r,null,[[4,17],[21,28]])})))()},handleSearch:function(){var e=this;return Object(d.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.searchTimeout&&clearTimeout(e.searchTimeout),e.searchTimeout=setTimeout(Object(d.a)(regeneratorRuntime.mark((function t(){var r,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.searchQuery.trim()){t.next=3;break}return e.searchResults=null,t.abrupt("return");case 3:if(t.prev=3,r=localStorage.getItem("spotify_access_token")){t.next=8;break}return console.error("No access token available"),t.abrupt("return");case 8:return t.next=10,e.$axios.$get("https://api.spotify.com/v1/search",{headers:{Authorization:"Bearer ".concat(r)},params:{q:e.searchQuery,type:"track,artist,playlist,category",limit:20}});case 10:n=t.sent,e.searchResults=n,t.next=17;break;case 14:t.prev=14,t.t0=t.catch(3),console.error("Error searching:",(null===(o=t.t0.response)||void 0===o?void 0:o.data)||t.t0.message);case 17:case"end":return t.stop()}}),t,null,[[3,14]])}))),300);case 2:case"end":return t.stop()}}),t)})))()},browseCategory:function(e){var t=this;return Object(d.a)(regeneratorRuntime.mark((function r(){var n,o,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,n=localStorage.getItem("spotify_access_token")){r.next=5;break}return console.error("No access token available"),r.abrupt("return");case 5:return r.next=7,t.$axios.$get("https://api.spotify.com/v1/browse/categories/".concat(e,"/playlists"),{headers:{Authorization:"Bearer ".concat(n)},params:{limit:20}});case 7:o=r.sent,t.searchResults=x(x({},t.searchResults),{},{playlists:o.playlists}),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(0),console.error("Error browsing category:",(null===(c=r.t0.response)||void 0===c?void 0:c.data)||r.t0.message);case 14:case"end":return r.stop()}}),r,null,[[0,11]])})))()},playArtist:function(e){var t=this;return Object(d.a)(regeneratorRuntime.mark((function r(){var n,o,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,n=localStorage.getItem("spotify_access_token")){r.next=5;break}return console.error("No access token available"),r.abrupt("return");case 5:return r.next=7,t.$axios.$put("https://api.spotify.com/v1/me/player",{device_ids:[t.deviceId],play:!1},{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 7:return r.next=9,t.$axios.$put("https://api.spotify.com/v1/me/player/play?device_id=".concat(t.deviceId),{context_uri:e},{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 9:console.log("Playing artist:",e),r.next=20;break;case 12:if(r.prev=12,r.t0=r.catch(0),console.error("Error playing artist:",(null===(o=r.t0.response)||void 0===o?void 0:o.data)||r.t0.message),404!==(null===(c=r.t0.response)||void 0===c?void 0:c.status)){r.next=20;break}return r.next=18,t.transferPlayback();case 18:return r.next=20,t.playArtist(e);case 20:case"end":return r.stop()}}),r,null,[[0,12]])})))()},formatTime:function(e){if(!e)return"0:00";var t=Math.floor(e/60),r=Math.floor(e%60);return"".concat(t,":").concat(r.toString().padStart(2,"0"))},seekTo:function(e){var t=this;return Object(d.a)(regeneratorRuntime.mark((function r(){var n,o,rect,c,l,d;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,(n=localStorage.getItem("spotify_access_token"))&&t.deviceId){r.next=4;break}return r.abrupt("return");case 4:return o=e.currentTarget,rect=o.getBoundingClientRect(),c=(e.clientX-rect.left)/rect.width,l=Math.floor(t.duration*c),r.next=10,t.$axios.$put("https://api.spotify.com/v1/me/player/seek?position_ms=".concat(1e3*l,"&device_id=").concat(t.deviceId),{},{headers:{Authorization:"Bearer ".concat(n)}});case 10:t.currentTime=l,r.next=16;break;case 13:r.prev=13,r.t0=r.catch(0),console.error("Error seeking:",(null===(d=r.t0.response)||void 0===d?void 0:d.data)||r.t0.message);case 16:case"end":return r.stop()}}),r,null,[[0,13]])})))()},setVolume:function(){var e=this;return Object(d.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e.player){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e.player.setVolume(e.volume/100);case 5:e.isMuted=0===e.volume,t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("Error setting volume:",t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},toggleMute:function(){this.isMuted?this.volume=this.previousVolume:(this.previousVolume=this.volume,this.volume=0),this.isMuted=!this.isMuted,this.setVolume()},isTrackLikedInSearch:function(e){return this.likedTracksIds.has(e)},handlePlayerReady:function(e){console.log("Player is ready in library page:",e),this.isPlayerReady=!0,this.setDeviceId(e),this.pendingTrack?(this.playTrack(this.pendingTrack),this.pendingTrack=null):this.pendingPlaylist&&(this.playPlaylist(this.pendingPlaylist),this.pendingPlaylist=null)},handlePlayerNotReady:function(){console.log("Player is not ready in library page"),this.isPlayerReady=!1},handlePlayerStateChanged:function(e){console.log("Player state changed in library page:",e)},openAddToPlaylistModal:function(track){var e=this;return Object(d.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.selectedTrack=track,e.showAddToPlaylistModal=!0,t.next=5,e.loadLibrary();case 5:t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("Error opening add to playlist modal:",t.t0),e.$toast.error("Erreur lors de l'ouverture de la modal");case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()},addTrackToPlaylist:function(e){var t=this;return Object(d.a)(regeneratorRuntime.mark((function r(){var n,o,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,Object(k.a)();case 3:if((n=r.sent)&&t.selectedTrack){r.next=7;break}return t.$toast.error("Erreur lors de l'ajout à la playlist"),r.abrupt("return");case 7:return r.next=9,t.$axios.$post("https://api.spotify.com/v1/playlists/".concat(e,"/tracks"),{uris:[t.selectedTrack.uri]},{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 9:return(o=t.userPlaylists.find((function(p){return p.id===e})))&&(o.tracks.total=(o.tracks.total||0)+1),t.$toast.success("Titre ajouté à la playlist"),t.showAddToPlaylistModal=!1,t.selectedTrack=null,r.next=16,t.loadLibrary();case 16:r.next=35;break;case 18:if(r.prev=18,r.t0=r.catch(0),console.error("Error adding track to playlist:",r.t0),t.$toast.error("Erreur lors de l'ajout à la playlist"),401!==(null===(c=r.t0.response)||void 0===c?void 0:c.status)){r.next=35;break}return r.prev=23,r.next=26,Object(k.a)();case 26:return r.next=28,t.addTrackToPlaylist(e);case 28:r.next=35;break;case 30:r.prev=30,r.t1=r.catch(23),console.error("Error refreshing token:",r.t1),t.$toast.error("Session expirée. Veuillez vous reconnecter."),t.$router.push("/login");case 35:case"end":return r.stop()}}),r,null,[[0,18],[23,30]])})))()}})},_=(r(384),r(49)),component=Object(_.a)(w,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"flex h-screen bg-gradient-to-br from-black via-[#2d0036] to-[#1a0022] text-white"},[t("Sidebar"),e._v(" "),t("main",{staticClass:"flex-1 overflow-y-auto"},[t("div",{staticClass:"p-8 bg-gradient-to-b from-black/80 via-[#2d0036]/80 to-[#1a0022]/90"},[t("div",{staticClass:"flex justify-between items-center mb-8"},[t("h1",{staticClass:"text-3xl font-bold text-pink-200"},[e._v("Votre Bibliothèque")]),e._v(" "),t("button",{staticClass:"bg-gradient-to-r from-pink-500 via-fuchsia-500 to-purple-500 hover:from-pink-400 hover:to-purple-400 text-white px-6 py-2 rounded-full flex items-center font-bold shadow-lg hover:shadow-pink-500/40 focus:outline-none focus:ring-4 focus:ring-pink-400",on:{click:function(t){e.showCreatePlaylistModal=!0}}},[t("i",{staticClass:"material-icons mr-2"},[e._v("add")]),e._v("\n          Créer une playlist\n        ")])]),e._v(" "),t("div",{staticClass:"flex space-x-4 mb-6"},[t("button",{class:["px-4 py-2 rounded-full transition-colors font-bold","playlists"===e.activeTab?"bg-gradient-to-r from-pink-500 to-purple-500 text-white":"text-pink-300 hover:text-pink-100"],on:{click:function(t){e.activeTab="playlists"}}},[e._v("\n          Playlists\n        ")]),e._v(" "),t("button",{class:["px-4 py-2 rounded-full transition-colors font-bold","liked"===e.activeTab?"bg-gradient-to-r from-pink-500 to-purple-500 text-white":"text-pink-300 hover:text-pink-100"],on:{click:function(t){e.activeTab="liked"}}},[e._v("\n          Titres likés\n        ")])]),e._v(" "),"liked"===e.activeTab?t("div",{staticClass:"mb-8"},[t("div",{staticClass:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"},e._l(e.likedTracks,(function(track){var n,o;return t("div",{key:track.id,staticClass:"bg-black/70 p-4 rounded-2xl hover:bg-pink-900/30 transition duration-200 ease-in-out transform hover:scale-105 shadow-lg shadow-pink-900/10"},[t("div",{staticClass:"relative group"},[t("img",{staticClass:"w-full h-40 object-cover mb-2 rounded shadow-lg border-2 border-pink-400",attrs:{src:(null==track||null===(n=track.album)||void 0===n||null===(n=n.images)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.url)||r(316),alt:(null==track?void 0:track.name)||"Unknown track"}}),e._v(" "),t("div",{staticClass:"absolute bottom-2 right-2 flex space-x-2"},[t("button",{staticClass:"bg-black/70 p-3 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200 border border-pink-400",on:{click:function(t){return e.toggleLike(track.id)}}},[t("i",{staticClass:"material-icons text-pink-400"},[e._v("favorite")])]),e._v(" "),t("button",{staticClass:"bg-gradient-to-r from-pink-500 to-purple-500 p-3 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200 shadow-lg shadow-pink-500/40",on:{click:function(t){return e.playTrack(track.uri)}}},[t("i",{staticClass:"material-icons"},[e._v("play_arrow")])]),e._v(" "),t("button",{staticClass:"bg-black/70 p-3 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200 border border-pink-400",on:{click:function(t){return e.openAddToPlaylistModal(track)}}},[t("i",{staticClass:"material-icons"},[e._v("playlist_add")])])])]),e._v(" "),t("h3",{staticClass:"text-lg font-semibold truncate text-pink-100"},[e._v(e._s((null==track?void 0:track.name)||"Unknown track"))]),e._v(" "),t("p",{staticClass:"text-pink-300 text-sm truncate"},[e._v(e._s((null==track||null===(o=track.artists)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.name)||"Unknown artist"))])])})),0)]):e._e(),e._v(" "),e.showAddToPlaylistModal?t("div",{staticClass:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},[t("div",{staticClass:"bg-black/90 p-6 rounded-2xl w-full max-w-md border border-pink-900 shadow-lg shadow-pink-900/20"},[t("h2",{staticClass:"text-2xl font-bold mb-4 text-pink-300"},[e._v("Ajouter à une playlist")]),e._v(" "),e.userPlaylists&&e.userPlaylists.length>0?t("div",{staticClass:"space-y-4 max-h-96 overflow-y-auto"},e._l(e.userPlaylists,(function(n){var o,c;return t("div",{key:n.id,staticClass:"flex items-center justify-between p-2 hover:bg-pink-900/30 rounded"},[t("div",{staticClass:"flex items-center"},[t("img",{staticClass:"w-12 h-12 object-cover rounded mr-4 border-2 border-pink-400",attrs:{src:(null==n||null===(o=n.images)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.url)||r(316),alt:(null==n?void 0:n.name)||"Unknown playlist"}}),e._v(" "),t("div",[t("h3",{staticClass:"font-semibold text-pink-100"},[e._v(e._s((null==n?void 0:n.name)||"Unknown playlist"))]),e._v(" "),t("p",{staticClass:"text-pink-300 text-sm"},[e._v(e._s((null==n||null===(c=n.tracks)||void 0===c?void 0:c.total)||0)+" titres")])])]),e._v(" "),t("button",{staticClass:"bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-400 hover:to-purple-400 text-white px-4 py-2 rounded-full shadow-lg shadow-pink-500/40",on:{click:function(t){return e.addTrackToPlaylist(n.id)}}},[e._v("\n                Ajouter\n              ")])])})),0):t("div",{staticClass:"text-center py-4"},[t("p",{staticClass:"text-pink-300"},[e._v("Aucune playlist disponible")])]),e._v(" "),t("div",{staticClass:"mt-6 flex justify-end"},[t("button",{staticClass:"px-4 py-2 text-pink-200 hover:text-pink-100",on:{click:function(t){e.showAddToPlaylistModal=!1}}},[e._v("\n              Fermer\n            ")])])])]):e._e(),e._v(" "),"playlists"===e.activeTab?t("div",{staticClass:"mb-8"},[t("div",{staticClass:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"},e._l(e.userPlaylists,(function(n){var o,c;return t("div",{key:n.id,staticClass:"bg-black/70 p-4 rounded-2xl hover:bg-pink-900/30 transition duration-200 ease-in-out transform hover:scale-105 shadow-lg shadow-pink-900/10"},[t("div",{staticClass:"relative group"},[t("nuxt-link",{staticClass:"block focus:outline-none focus:ring-2 focus:ring-pink-400 rounded",attrs:{to:"/playlist/".concat(n.id)}},[t("img",{staticClass:"w-full h-40 object-cover mb-2 rounded shadow-lg border-2 border-pink-400 transition-transform duration-200 group-hover:scale-105",attrs:{src:(null==n||null===(o=n.images)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.url)||r(316),alt:(null==n?void 0:n.name)||"Unknown playlist"}}),e._v(" "),t("h3",{staticClass:"text-lg font-semibold truncate text-pink-100 text-center mt-2"},[e._v(e._s((null==n?void 0:n.name)||"Unknown playlist"))])]),e._v(" "),t("div",{staticClass:"absolute bottom-2 right-2 flex space-x-2"},[t("button",{staticClass:"bg-gradient-to-r from-pink-500 to-purple-500 p-3 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200 shadow-lg shadow-pink-500/40",on:{click:function(t){return e.playPlaylist(n.uri)}}},[t("i",{staticClass:"material-icons"},[e._v("play_arrow")])])])],1),e._v(" "),t("p",{staticClass:"text-pink-300 text-sm truncate text-center"},[e._v(e._s((null==n||null===(c=n.tracks)||void 0===c?void 0:c.total)||0)+" titres")]),e._v(" "),t("button",{staticClass:"mt-2 w-full bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-400 hover:to-purple-400 text-white py-2 px-4 rounded-full flex items-center justify-center font-bold shadow-lg shadow-pink-500/40",on:{click:function(t){return e.playPlaylist(n.uri)}}},[t("i",{staticClass:"material-icons mr-2"},[e._v("play_arrow")]),e._v("\n              LIRE\n            ")])])})),0)]):e._e(),e._v(" "),e.showCreatePlaylistModal?t("div",{staticClass:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},[t("div",{staticClass:"bg-black/90 p-6 rounded-2xl w-full max-w-md border border-pink-900 shadow-lg shadow-pink-900/20"},[t("h2",{staticClass:"text-2xl font-bold mb-4 text-pink-300"},[e._v("Créer une nouvelle playlist")]),e._v(" "),t("form",{on:{submit:function(t){return t.preventDefault(),e.createPlaylist.apply(null,arguments)}}},[t("div",{staticClass:"mb-4"},[t("label",{staticClass:"block text-pink-200 mb-2"},[e._v("Nom de la playlist")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newPlaylistName,expression:"newPlaylistName"}],staticClass:"w-full px-4 py-2 bg-black/70 text-white rounded focus:outline-none focus:ring-2 focus:ring-pink-400 border border-pink-400",attrs:{type:"text",placeholder:"Ma nouvelle playlist",required:""},domProps:{value:e.newPlaylistName},on:{input:function(t){t.target.composing||(e.newPlaylistName=t.target.value)}}})]),e._v(" "),t("div",{staticClass:"mb-4"},[t("label",{staticClass:"block text-pink-200 mb-2"},[e._v("Description")]),e._v(" "),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.newPlaylistDescription,expression:"newPlaylistDescription"}],staticClass:"w-full px-4 py-2 bg-black/70 text-white rounded focus:outline-none focus:ring-2 focus:ring-pink-400 border border-pink-400",attrs:{placeholder:"Ajouter une description (optionnel)",rows:"3"},domProps:{value:e.newPlaylistDescription},on:{input:function(t){t.target.composing||(e.newPlaylistDescription=t.target.value)}}})]),e._v(" "),t("div",{staticClass:"flex justify-end space-x-4"},[t("button",{staticClass:"px-4 py-2 text-pink-200 hover:text-pink-100",attrs:{type:"button"},on:{click:function(t){e.showCreatePlaylistModal=!1}}},[e._v("\n                Annuler\n              ")]),e._v(" "),t("button",{staticClass:"px-6 py-2 bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-400 hover:to-purple-400 text-white rounded-full font-bold shadow-lg shadow-pink-500/40",attrs:{type:"submit"}},[e._v("\n                Créer\n              ")])])])])]):e._e()])]),e._v(" "),t("PlayerBar")],1)}),[],!1,null,"29dfe8e3",null);t.default=component.exports}}]);